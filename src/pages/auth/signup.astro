---
import Layout from "../../layouts/Layout.astro";
---

<Layout>
  <main>
    <h1>Sign Up</h1>
    <form id="signup-form">
      <label>
        Email
        <input type="email" name="email" required />
      </label>
      <label>
        Password
        <input type="password" name="password" required />
      </label>
      <button type="submit">Create Account</button>
    </form>
    <p>
      <a href="/auth/sign-in">Already have an account? Sign in</a>
    </p>
  </main>
</Layout>

<script>
  import { authClient } from "../../utils/api";
  const form = document.getElementById("signup-form") as HTMLFormElement;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const email = formData.get("email") as string;
    const password = formData.get("password") as string;

    if (!email || !password) {
      return;
    }

    try {
      const response = await authClient.signUp.email({
        name: "Sample User" + Math.floor(Math.random() * 100),
        email,
        password,
        fetchOptions: {
          onSuccess: () => {
            console.log("Sign up successful");
            // window.location.href = "/auth/verify";
          },
          onError: (ctx) => {
          },
        },
      });
    } catch (error) {
      console.error("An error occurred during sign up:", error);
    }
  });
</script>